#!/usr/bin/env python3
"""
Setup CME API credentials securely.
Prompts for credentials interactively and stores in .env file (not checked into git).
"""

import os
import getpass
from pathlib import Path

PROJECT_DIR = Path(__file__).parent
ENV_FILE = PROJECT_DIR / ".env"

def setup_cme_credentials():
    """Prompt for CME credentials and save to .env file."""
    
    print("\n" + "="*60)
    print("CME API SETUP")
    print("="*60)
    print("\nEnter your CME WebSocket API credentials.")
    print("(These will be saved securely in .env and NOT checked into git)\n")
    
    # Get credentials
    username = input("CME Username: ").strip()
    password = getpass.getpass("CME Password: ")
    
    # Optional: API endpoint (CME may provide this)
    endpoint = input("CME WebSocket Endpoint URL (press Enter for default): ").strip()
    if not endpoint:
        endpoint = "wss://api.cmegroup.com/ws"  # Example default
    
    # Write to .env
    env_content = f"""# CME API Credentials (generated by setup_cme.py)
# Do not commit this file to git
CME_USERNAME={username}
CME_PASSWORD={password}
CME_ENDPOINT={endpoint}
"""
    
    with open(ENV_FILE, "w") as f:
        f.write(env_content)
    
    # Restrict permissions to owner only
    os.chmod(ENV_FILE, 0o600)
    
    print("\n" + "="*60)
    print("âœ… Credentials saved to .env")
    print("="*60)
    print(f"\nFile: {ENV_FILE}")
    print("Permissions: 600 (owner read/write only)")
    print("\nThe dashboard will read these on launch.")
    print("If you need to update them, run this script again.\n")

if __name__ == "__main__":
    setup_cme_credentials()
